{
    "project_name": "iac",
    "app_name": "openObserve",
    "__README__": "NOTE: iac_core_name should only be used if vpc and alb are pre-created in another stack.",
    "iac_core_name": "iacCore",
    "vpc": {
        "__README__": "NOTE: create if you don't have a vpc created with public and support subnets.",
        "create": true,
        "name": "dev",
        "CIDR": "",
        "subnet_cidr_mask": 20,
        "max_azs": 3,
        "ngw_count": 1,
        "fck_nat": true,
        "create_cidr_using_modulus": true
    },
    "alb": {
        "__README__": "NOTE: create if you don't have an alb created using public and support subnets.",
        "create": true
    },
    "route53": {
        "__README__": "NOTE: Make sure you pre-create this hosted zone in Route53!",
        "domain_name": "dev.example.com",
        "base_fqdns": [
            "dev.example.com"
        ],
        "ttl": 60
    },
    "aws_org_ids": [
    ],
    "s3": {
        "README1": "Create S3 bucket for openObserve data accessible by org members and writable by ecs service roles",
        "create": true
    },
    "ecr": {
        "__README__": "NOTE: Make sure you pre-create a repo named openobserve/slim in your ECR repository and push the image to it!",
        "repository_region": "us-east-2",
        "repository_account": "123456789012"
    },
    "aurora": {
        "db_name": "openobserve",
        "master_username": "postgres",
        "max_acu": 2,
        "min_acu": 0,
        "seconds_until_auto_pause": 1800,
        "reader_count": 1,
        "global_enabled": false,
        "deletion_protection": false,
        "backup_retention_period": 7,
        "preferred_backup_window": "02:00-04:00",
        "preferred_maintenance_window": "sun:04:00-sun:06:00"
    },
    "database_service_accounts": [
        {
            "name": "openobserve_svc",
            "permissions": ["SELECT", "INSERT", "UPDATE", "DELETE"],
            "tables": ["*"],
            "schema_permissions": ["USAGE", "CREATE"],
            "database_privileges": ["CREATEDB", "CREATEROLE"],
            "update_permissions": true
        }
    ],
    "ecs": {
        "mount_gp3_volume": false,
        "enable_container_insights": false,
        "max_autoscale_task_count": 2,
        "deployment": {
            "minimum_healthy_percent": 100,
            "maximum_percent": 200,
            "circuit_breaker": {
                "enable": true,
                "rollback": true
            }
        },
        "autoscaling": {
            "enable_autoscaling": true,
            "min_capacity": 0,
            "max_capacity": 5,
            "cpu_target_value": 70,
            "memory_target_value": 80
        },
        "off_hours_scaling": {
            "enabled": false,
            "scale_down_cron": "cron(0 3 ? * * *)",  
            "scale_up_cron": "cron(0 12 ? * MON-FRI *)",   
            "scale_to_zero": false
        },
        "environment_README": "Global env CONFIG spans all services",
        "task_def": {
            "desired_count": 1,
            "vCPU": 2048,
            "vRAM" : 4096,
            "cpu_architecture": "ARM64",
            "spot": true
        },
        "deploy_as_service": true,
        "deploy_as_web_app": true,
        "mount_efs": false,
        "application_ports": {
            "ingress_internal": {
                "tcp": [5080]
            }
        }
    },
    "nats": {
        "desired_count": 2,
        "cluster_name": "nats-cluster",
        "cluster_port": 6222
    },
    "ecs_services1": {
        "dex": {
            "alb_priority": 13,
            "repository_name": "dexidp/dex",
            "image_tag": "v2.37.0",
            "command": ["/openobserve"],
            "working_dir": "/",
            "environment": {
                "ZO_NODE_ROLE": "all"
            }
        }
    },
    "ecs_services": {   
        "ingester": {
            "mount_gp3_volume": true,
            "alb_priority": 11,
            "repository_name": "__ECR_REPO__/openobserve/slim",
            "image_tag": "v0.20.3",
            "command": ["/entrypoint.sh"],
            "working_dir": "/",
            "environment": {

                "__COMMENT1__": "# Basic configuration",                
                "ZO_APP_NAME": "openobserve",
                "ZO_CLUSTER_NAME": "o2",
                "ZO_NODE_ROLE": "ingester,querier,compactor",
                "ZO_LOCAL_MODE": "false",
                "ZO_LOCAL_MODE_STORAGE": "disk",
                "ZO_HTTP_PORT": "5080",
                "ZO_HTTP_ADDR": "0.0.0.0",
                "ZO_GRPC_PORT": "5081",
                "ZO_GRPC_ADDR": "0.0.0.0",   
                
                "__COMMENT2__": "# Auth configuration (same as frontend)",
                "ZO_ROOT_USER_EMAIL": "root@example.com",
                "ZO_ROOT_USER_PASSWORD": "SSM",
                "ZO_ROOT_USER_TOKEN": "", 

                "__COMMENT3__": "# NATS configuration - address is added in the ECS task definition",
                "ZO_CLUSTER_COORDINATOR": "nats",
                "ZO_QUEUE_STORE": "nats",
                "ZO_NATS_PREFIX": "o2_",
                "ZO_NATS_USER": "",
                "ZO_NATS_PASSWORD": "",
                "ZO_NATS_REPLICAS": "2",
                "ZO_NATS_CONNECT_TIMEOUT": "5",
                "ZO_NATS_COMMAND_TIMEOUT": "10",
                "ZO_NATS_V211_SUPPORT": "false",
          
                "__COMMENT4__": "# Postgres configuration - DSN is added in the ECS task definition",
                "ZO_META_STORE": "postgres",
          
                "__COMMENT5__": "# S3/Minio configuration (using local MinIO) - S3_SERVER_URL is added in the ECS task definition",
                "ZO_S3_PROVIDER": "s3",
          
                "__COMMENT6__": "# Data directories",
                "ZO_DATA_DIR": "./data/",
                "ZO_DATA_DB_DIR": "",
                "ZO_DATA_WAL_DIR": "",
                "ZO_DATA_IDX_DIR": "",
                "ZO_DATA_STREAM_DIR": "",
                "ZO_DATA_CACHE_DIR": "",
          
                "__COMMENT7__": "# UI configuration (disabled for ingester)",
                "ZO_UI_ENABLED": "false",
          
                "__COMMENT8__": "# Feature flags",
                "ZO_TELEMETRY": "false",
                "ZO_HEALTH_CHECK_ENABLED": "true",
                "ZO_PRINT_KEY_CONFIG": "false",
                "ZO_SWAGGER_ENABLED": "false",
          
                "__COMMENT9__": "# Timeouts and limits",
                "ZO_ACTIX_REQ_TIMEOUT": "30",
                "ZO_QUERY_TIMEOUT": "600",
                "ZO_GRPC_INGEST_TIMEOUT": "600",
                "ZO_ROUTE_TIMEOUT": "600",
                "ZO_JSON_LIMIT": "209715200",
                "ZO_PAYLOAD_LIMIT": "209715200",
          
                "__COMMENT10__": "# Compactor specific settings",
                "ZO_COMPACT_ENABLED": "true",
                "ZO_COMPACT_INTERVAL": "10",
                "ZO_COMPACT_MAX_FILE_SIZE": "512"     
            }
        },
        "frontend": {
            "alb_priority": 21,
            "repository_name": "__ECR_REPO__/openobserve/slim",
            "image_tag": "v0.20.3",
            "command": ["/entrypoint.sh"],
            "working_dir": "/",
            "environment": {
                "__COMMENT1__": "# Basic configuration",                
                "ZO_APP_NAME": "openobserve",
                "ZO_CLUSTER_NAME": "o2",
                "ZO_NODE_ROLE": "all",
                "ZO_LOCAL_MODE": "false",
                "ZO_LOCAL_MODE_STORAGE": "disk",
                "ZO_HTTP_PORT": "5080",
                "ZO_HTTP_ADDR": "0.0.0.0",
                "ZO_GRPC_PORT": "5081",
                "ZO_GRPC_ADDR": "0.0.0.0",   
                
                "__COMMENT2__": "# Auth configuration",
                "ZO_ROOT_USER_EMAIL": "root@example.com",
                "ZO_ROOT_USER_PASSWORD": "SSM",
                "ZO_ROOT_USER_TOKEN": "", 

                "__COMMENT3__": "# NATS configuration - address is added in the ECS task definition",
                "ZO_CLUSTER_COORDINATOR": "nats",
                "ZO_QUEUE_STORE": "nats",
                "ZO_NATS_PREFIX": "o2_",
                "ZO_NATS_USER": "",
                "ZO_NATS_PASSWORD": "",
                "ZO_NATS_REPLICAS": "2",
                "ZO_NATS_CONNECT_TIMEOUT": "5",
                "ZO_NATS_COMMAND_TIMEOUT": "10",
                "ZO_NATS_V211_SUPPORT": "false",
          
                "__COMMENT4__": "# Postgres configuration - DSN is added in the ECS task definition",
                "ZO_META_STORE": "postgres",
          
                "__COMMENT5__": "# S3/Minio configuration (using local MinIO) - S3_SERVER_URL is added in the ECS task definition",
                "ZO_S3_PROVIDER": "s3",
          
                "__COMMENT6__": "# Data directories",
                "ZO_DATA_DIR": "./data/",
                "ZO_DATA_DB_DIR": "",
                "ZO_DATA_WAL_DIR": "",
                "ZO_DATA_IDX_DIR": "",
                "ZO_DATA_STREAM_DIR": "",
                "ZO_DATA_CACHE_DIR": "",
          
                "__COMMENT7__": "# UI configuration (disabled for ingester)",
                "ZO_UI_ENABLED": "true",
                "ZO_WEB_URL": "",
                "ZO_BASE_URI": "",
          
                "__COMMENT8__": "# Feature flags",
                "ZO_TELEMETRY": "false",
                "ZO_HEALTH_CHECK_ENABLED": "true",
                "ZO_PRINT_KEY_CONFIG": "false",
                "ZO_SWAGGER_ENABLED": "true",
          
                "__COMMENT9__": "# Timeouts and limits",
                "ZO_ACTIX_REQ_TIMEOUT": "30",
                "ZO_QUERY_TIMEOUT": "600",
                "ZO_GRPC_INGEST_TIMEOUT": "600",
                "ZO_ROUTE_TIMEOUT": "600",
                "ZO_JSON_LIMIT": "209715200",
                "ZO_PAYLOAD_LIMIT": "209715200",
          
                "__COMMENT10__": "# Compactor specific settings",
                "ZO_COMPACT_ENABLED": "true",
                "ZO_COMPACT_INTERVAL": "10",
                "ZO_COMPACT_MAX_FILE_SIZE": "512"              
            }
        }
    }
}

